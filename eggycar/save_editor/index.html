<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Eggy Car Save Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #e9ecef; }
        .box { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #343a40; }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1.1em;
        }
        .btn-save { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: background 0.3s;
        }
        .btn-save:hover { background: #0056b3; }
        #status { margin-top: 15px; font-weight: bold; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="box">
    <h2>Eggy Car Save Editor</h2>
    <p>Edit your save file for the game Eggy Car</p>

    <div class="input-group">
        <label for="bestScore">Best Score</label>
        <input type="number" id="bestScore" min="0" placeholder="Loading...">
    </div>

    <div class="input-group">
        <label for="coins">Coins</label>
        <input type="number" id="coins" min="0" placeholder="Loading...">
    </div>

    <button class="btn-save" id="saveBtn">Save All Changes</button>
    <div id="status"></div>
</div>

<script>
    const KEY_BEST = 'eggcar_best';
    const KEY_COINS = 'eggcar_coins';

    const inputBest = document.getElementById('bestScore');
    const inputCoins = document.getElementById('coins');
    const saveBtn = document.getElementById('saveBtn');
    const statusDiv = document.getElementById('status');

    function showStatus(msg, isError = false) {
        statusDiv.innerText = msg;
        statusDiv.style.color = isError ? 'red' : 'green';
        setTimeout(() => { statusDiv.innerText = ''; }, 3000);
    }

    /**
     * Loads numerical data from localForage and populates the input fields.
     */
    async function loadData() {
        showStatus('Loading data...', false);
        try {
            // Retrieve both values in parallel for efficiency
            const [best, coins] = await Promise.all([
                localforage.getItem(KEY_BEST),
                localforage.getItem(KEY_COINS)
            ]);

            // Ensure we handle null/undefined/non-numeric values gracefully
            const currentBest = (typeof best === 'number' && !isNaN(best)) ? best : 0;
            const currentCoins = (typeof coins === 'number' && !isNaN(coins)) ? coins : 0;

            inputBest.value = currentBest;
            inputCoins.value = currentCoins;

            showStatus('Data loaded successfully.', false);

        } catch (err) {
            console.error('Error loading data from localforage:', err);
            showStatus('Error loading data. Check console.', true);
        }
    }

    /**
     * Reads values from the input fields and saves them back to localForage.
     */
    async function saveData() {
        showStatus('Saving changes...', false);
        try {
            // Get values from the input fields and ensure they are parsed as numbers
            const newBest = parseInt(inputBest.value) || 0;
            const newCoins = parseInt(inputCoins.value) || 0;

            // Save both values in parallel
            await Promise.all([
                localforage.setItem(KEY_BEST, newBest),
                localforage.setItem(KEY_COINS, newCoins)
            ]);

            showStatus('Changes saved successfully!', false);

        } catch (err) {
            console.error('Error saving data to localforage:', err);
            showStatus('Error saving data. Check console.', true);
        }
    }

    // Attach event listener
    saveBtn.addEventListener('click', saveData);
    
    // Load data on page load
    window.onload = loadData;
</script>
</body>
</html>